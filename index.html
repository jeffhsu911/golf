<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é«˜çˆ¾å¤«ç‡’çƒè¨ˆç®—æ©Ÿ v2.0</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        #loading {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #f8fafc; display: flex; flex-direction: column;
            justify-content: center; align-items: center; z-index: 9999;
            color: #475569; font-family: sans-serif; text-align: center; padding: 20px;
        }
    </style>
</head>
<body class="bg-slate-50 text-gray-900 touch-pan-y">
    
    <div id="root">
        <div id="loading">
            <div style="font-size: 24px; font-weight: bold; margin-bottom: 10px;">â›³ï¸ ç‡’çƒè¨ˆç®—æ©Ÿ v2.0</div>
            <div>è¼‰å…¥ä¸­...</div>
        </div>
    </div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- Icons ---
        const Icon = ({ children, size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{children}</svg>
        );
        const Trophy = (p) => <Icon {...p}><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6" /><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18" /><path d="M4 22h16" /><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22" /><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22" /><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z" /></Icon>;
        const SettingsIcon = (p) => <Icon {...p}><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.09a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z" /><circle cx="12" cy="12" r="3" /></Icon>;
        const Save = (p) => <Icon {...p}><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" /><polyline points="17 21 17 13 7 13 7 21" /><polyline points="7 3 7 8 15 8" /></Icon>;
        const RotateCcw = (p) => <Icon {...p}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8" /><path d="M3 3v5h5" /></Icon>;
        const ChevronLeft = (p) => <Icon {...p}><path d="m15 18-6-6 6-6" /></Icon>;
        const ChevronRight = (p) => <Icon {...p}><path d="m9 18 6-6-6-6" /></Icon>;
        const DollarSign = (p) => <Icon {...p}><line x1="12" x2="12" y1="2" y2="22" /><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" /></Icon>;
        const Circle = (p) => <Icon {...p}><circle cx="12" cy="12" r="10" /></Icon>;
        const MousePointer2 = (p) => <Icon {...p}><path d="m4.037 4.688.495.495.651-.651 16 6.5-.063.947-6.124 1.58a2 2 0 0 0-1.438 1.435l-1.579 6.126-.947.063z" /></Icon>;
        const TrendingUp = (p) => <Icon {...p}><polyline points="22 7 13.5 15.5 8.5 10.5 2 17" /><polyline points="16 7 22 7 22 13" /></Icon>;
        const Users = (p) => <Icon {...p}><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" /><circle cx="9" cy="7" r="4" /><path d="M22 21v-2a4 4 0 0 0-3-3.87" /><path d="M16 3.13a4 4 0 0 1 0 7.75" /></Icon>;

        // --- Config ---

        const MAX_PLAYERS = 4;
        const INITIAL_PLAYER_DATA = [
            { id: 0, name: 'çƒå“¡ A', handicaps: { 3: 0, 4: 0, 5: 0 } },
            { id: 1, name: 'çƒå“¡ B', handicaps: { 3: 0, 4: 0, 5: 0 } },
            { id: 2, name: 'çƒå“¡ C', handicaps: { 3: 0, 4: 0, 5: 0 } },
            { id: 3, name: 'çƒå“¡ D', handicaps: { 3: 0, 4: 0, 5: 0 } },
        ];

        const INITIAL_SETTINGS = {
            game1Price: 100,
            game2Price: 100,
            game3Price: 100,
            strictMode: false,
            playerCount: 4, // Default to 4
        };

        const DEFAULT_PARS = [4, 4, 3, 4, 4, 5, 4, 3, 5, 4, 4, 3, 4, 4, 5, 4, 3, 5];

        // Added 'Nozzle' to the roles
        const GSBI_ROLES = [
            { key: 'nozzle', label: 'è«¾èŒ²é­¯ (åˆ‡)', points: 5, color: 'text-purple-600', bg: 'bg-purple-100', border: 'border-purple-600', dot: 'bg-purple-500' },
            { key: 'gold', label: 'é‡‘ (é )', points: 4, color: 'text-yellow-500', bg: 'bg-yellow-100', border: 'border-yellow-500', dot: 'bg-yellow-400' },
            { key: 'silver', label: 'éŠ€ (äºŒ)', points: 3, color: 'text-gray-500', bg: 'bg-gray-100', border: 'border-gray-500', dot: 'bg-gray-400' },
            { key: 'bronze', label: 'éŠ… (ä¸‰)', points: 2, color: 'text-orange-600', bg: 'bg-orange-100', border: 'border-orange-600', dot: 'bg-orange-400' },
            { key: 'iron', label: 'éµ (è¿‘)', points: 1, color: 'text-slate-600', bg: 'bg-slate-200', border: 'border-slate-600', dot: 'bg-slate-600' },
        ];

        const App = () => {
            const [activeTab, setActiveTab] = useState('input');
            const [currentHole, setCurrentHole] = useState(1);
            
            // Full player database (always keeps 4 in memory, but displays fewer)
            const [allPlayers, setAllPlayers] = useState(INITIAL_PLAYER_DATA);
            const [settings, setSettings] = useState(INITIAL_SETTINGS);
            
            const [holes, setHoles] = useState(() => {
                return Array.from({ length: 18 }, (_, i) => ({
                    number: i + 1,
                    par: DEFAULT_PARS[i],
                    scores: [null, null, null, null],
                    rats: [0, 0, 0, 0],
                    gsbi: {
                        nozzle: { playerId: null, success: false },
                        gold: { playerId: null, success: false },
                        silver: { playerId: null, success: false },
                        bronze: { playerId: null, success: false },
                        iron: { playerId: null, success: false },
                    }
                }));
            });

            // Derived state: Active players based on count
            const activePlayers = useMemo(() => {
                return allPlayers.slice(0, settings.playerCount);
            }, [allPlayers, settings.playerCount]);

            // Load/Save
            useEffect(() => {
                try {
                    const savedData = localStorage.getItem('golfAppData_v3');
                    if (savedData) {
                        const parsed = JSON.parse(savedData);
                        if (parsed.allPlayers) setAllPlayers(parsed.allPlayers);
                        else if (parsed.players) setAllPlayers(parsed.players); // migration
                        setSettings({...INITIAL_SETTINGS, ...parsed.settings});
                        // Ensure nozzle exists in loaded holes (migration)
                        const migratedHoles = parsed.holes.map(h => ({
                            ...h,
                            gsbi: { nozzle: { playerId: null, success: false }, ...h.gsbi }
                        }));
                        setHoles(migratedHoles);
                    }
                } catch (e) { console.error("Load failed", e); }
            }, []);

            useEffect(() => {
                try {
                    localStorage.setItem('golfAppData_v3', JSON.stringify({ allPlayers, settings, holes }));
                } catch (e) {}
            }, [allPlayers, settings, holes]);

            // --- Calculation ---
            const results = useMemo(() => {
                let totals = [0, 0, 0, 0];
                let currentMultiplier = 1;
                const carryOverStatus = Array(18).fill(false);
                const count = activePlayers.length;

                holes.forEach((hole, index) => {
                    // 1. GSBI & Nozzle
                    GSBI_ROLES.forEach(role => {
                        const assignment = hole.gsbi[role.key];
                        // Only count if player is within active count
                        if (assignment.playerId !== null && assignment.playerId < count && assignment.success) {
                            const winnerId = assignment.playerId;
                            const points = role.points;
                            const money = points * settings.game1Price;
                            
                            // Winner takes from ALL other active players
                            // Example: 4 players. Winner gets 4 pts * $100 * 3 opponents = $1200
                            totals[winnerId] += money * (count - 1);

                            activePlayers.forEach(p => {
                                if (p.id !== winnerId) {
                                    totals[p.id] -= money;
                                }
                            });
                        }
                    });

                    // 2. Rats
                    activePlayers.forEach(p => {
                        const ratCount = hole.rats[p.id] || 0;
                        if (ratCount > 0) {
                            const money = ratCount * settings.game3Price;
                            totals[p.id] -= money * (count - 1); // Pay everyone else
                            activePlayers.forEach(other => {
                                if (other.id !== p.id) {
                                    totals[other.id] += money;
                                }
                            });
                        }
                    });

                    // 3. Stroke Play
                    const currentHoleScores = activePlayers.map(p => {
                        const s = hole.scores[p.id];
                        return (s === null || s === '') ? null : Number(s);
                    });
                    
                    const validScores = currentHoleScores.filter(s => s !== null);
                    
                    // Need at least 2 scores to compare
                    if (validScores.length >= 2) {
                        let isHoleValid = true;
                        if (settings.strictMode) {
                            const minScore = Math.min(...validScores);
                            if (minScore > hole.par + 1) isHoleValid = false;
                        }

                        if (!isHoleValid) {
                            carryOverStatus[index] = true;
                            currentMultiplier += 1;
                        } else {
                            // Compare every pair
                            for (let i = 0; i < count; i++) {
                                for (let j = i + 1; j < count; j++) {
                                    const sI = currentHoleScores[i];
                                    const sJ = currentHoleScores[j];
                                    if (sI !== null && sJ !== null) {
                                        const hI = activePlayers[i].handicaps[hole.par] || 0;
                                        const hJ = activePlayers[j].handicaps[hole.par] || 0;
                                        const netI = sI + hI;
                                        const netJ = sJ + hJ;
                                        
                                        let units = 0;
                                        if (netI < netJ) units = 1;
                                        else if (netI > netJ) units = -1;

                                        const amount = units * settings.game2Price * currentMultiplier;
                                        totals[i] += amount;
                                        totals[j] -= amount;
                                    }
                                }
                            }
                            currentMultiplier = 1;
                        }
                    }
                });

                return { totals, carryOverStatus, currentMultiplier };
            }, [holes, settings, activePlayers]);

            // --- Handlers ---
            const updateHole = (field, val, pid, sub) => {
                setHoles(prev => {
                    const next = [...prev];
                    const h = next[currentHole - 1];
                    if (field === 'score') h.scores[pid] = val;
                    if (field === 'rat') h.rats[pid] = Math.max(0, val);
                    if (field === 'par') h.par = val;
                    if (field === 'gsbi') h.gsbi[sub] = { ...h.gsbi[sub], ...val };
                    return next;
                });
            };
            
            const updatePlayer = (id, name) => {
                setAllPlayers(prev => prev.map(p => p.id === id ? { ...p, name } : p));
            };

            const updateHandicap = (id, par, val) => {
                setAllPlayers(prev => prev.map(p => p.id === id ? { ...p, handicaps: { ...p.handicaps, [par]: Number(val) } } : p));
            };

            const resetAll = () => {
                if (confirm('ç¢ºå®šé‡ç½®ï¼Ÿ')) {
                    setHoles(Array.from({ length: 18 }, (_, i) => ({
                        number: i + 1, par: DEFAULT_PARS[i], scores: [null,null,null,null], rats: [0,0,0,0],
                        gsbi: { nozzle: {playerId:null,success:false}, gold: {playerId:null,success:false}, silver: {playerId:null,success:false}, bronze: {playerId:null,success:false}, iron: {playerId:null,success:false} }
                    })));
                    setCurrentHole(1);
                }
            };

            // --- Views ---

            const InputView = () => {
                const hole = holes[currentHole-1];
                const multiplier = (() => {
                    if (!settings.strictMode) return 1;
                    let m = 1;
                    for (let i=0; i<currentHole-1; i++) {
                         const scores = activePlayers.map(p => holes[i].scores[p.id]).filter(s => s);
                         if(scores.length > 0 && Math.min(...scores) > holes[i].par + 1) m++;
                         else if (scores.length > 0) m = 1;
                    }
                    return m;
                })();
                const isCarry = results.carryOverStatus[currentHole-1];

                return (
                    <div className="space-y-4 pb-24">
                        {/* Nav */}
                        <div className="flex justify-between items-center bg-white p-4 rounded-xl shadow-sm border relative overflow-hidden">
                            {multiplier > 1 && <div className="absolute top-0 right-0 p-1 bg-red-100 text-red-600 text-[10px] font-bold rounded-bl-lg">ç´¯ç© x{multiplier}</div>}
                            <button onClick={()=>setCurrentHole(h=>Math.max(1, h-1))} disabled={currentHole===1} className="p-2 bg-gray-100 rounded-full"><ChevronLeft/></button>
                            <div className="text-center">
                                <h2 className="text-xl font-bold flex items-center justify-center gap-2">
                                    ç¬¬ {currentHole} æ´
                                    {multiplier > 1 && <span className="text-xs bg-red-500 text-white px-2 rounded-full">x{multiplier}</span>}
                                </h2>
                                <div className="flex justify-center gap-2 mt-1">
                                    <span className="text-sm text-gray-500">Par</span>
                                    <select value={hole.par} onChange={(e)=>updateHole('par', Number(e.target.value))} className="bg-gray-50 border rounded px-2 text-sm">
                                        {[3,4,5,6].map(p=><option key={p} value={p}>{p}</option>)}
                                    </select>
                                </div>
                                {settings.strictMode && <div className="text-[10px] text-gray-400">é–€æª»: {hole.par+1}æ¡¿</div>}
                            </div>
                            <button onClick={()=>setCurrentHole(h=>Math.min(18, h+1))} disabled={currentHole===18} className="p-2 bg-gray-100 rounded-full"><ChevronRight/></button>
                        </div>

                        {/* Scores */}
                        <div className={`bg-white rounded-xl shadow-sm border ${isCarry?'border-red-200':'border-gray-100'}`}>
                            <div className={`px-4 py-2 border-b flex justify-between items-center ${isCarry?'bg-red-50':'bg-gray-50'}`}>
                                <span className="font-bold text-gray-700 flex gap-2"><DollarSign size={18}/> æ¡¿æ•¸ & è€é¼ </span>
                                {isCarry && <span className="text-xs text-red-600 font-bold flex gap-1"><TrendingUp size={12}/> æµå±€ç´¯ç©</span>}
                            </div>
                            <div className="divide-y divide-gray-100">
                                {activePlayers.map(p => {
                                    const sc = hole.scores[p.id];
                                    const fail = settings.strictMode && sc && Number(sc) > hole.par+1;
                                    return (
                                        <div key={p.id} className="grid grid-cols-12 gap-2 p-3 items-center">
                                            <div className="col-span-4 font-medium truncate">
                                                {p.name}
                                                {fail && <span className="text-[9px] text-red-300 block">æœªé”æ¨™</span>}
                                            </div>
                                            <div className="col-span-4 text-center">
                                                <input type="number" inputMode="numeric" placeholder="-" value={sc??''} onChange={e=>updateHole('score',e.target.value,p.id)}
                                                    className={`w-full text-center border rounded py-2 text-lg font-bold ${fail?'text-gray-400 border-red-100':'text-gray-900 focus:ring-2'}`} />
                                                <div className="text-[10px] text-gray-400">{p.handicaps[hole.par]>0 ? `è®“${p.handicaps[hole.par]}`:''}</div>
                                            </div>
                                            <div className="col-span-4 flex justify-end gap-1">
                                                <div className="flex items-center bg-red-50 rounded border border-red-100 p-1">
                                                    <MousePointer2 size={14} className="text-red-500 mr-1"/>
                                                    <button className="w-6 bg-white rounded shadow-sm text-gray-600 font-bold" onClick={()=>updateHole('rat',(hole.rats[p.id]||0)-1,p.id)}>-</button>
                                                    <span className="w-5 text-center font-bold text-red-600">{hole.rats[p.id]}</span>
                                                    <button className="w-6 bg-white rounded shadow-sm text-gray-600 font-bold" onClick={()=>updateHole('rat',(hole.rats[p.id]||0)+1,p.id)}>+</button>
                                                </div>
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        </div>

                        {/* GSBI */}
                        <div className="bg-white rounded-xl shadow-sm border border-gray-100">
                            <div className="bg-yellow-50 px-4 py-2 border-b border-yellow-100 font-bold text-yellow-800 flex gap-2">
                                <Trophy size={18}/> è«¾èŒ²é­¯ & é‡‘éŠ€éŠ…éµ
                            </div>
                            <div className="p-3 space-y-3">
                                {GSBI_ROLES.map(role => {
                                    const assign = hole.gsbi[role.key];
                                    return (
                                        <div key={role.key} className={`flex justify-between items-center p-2 rounded border ${role.border} ${role.bg} bg-opacity-20`}>
                                            <span className={`font-bold ${role.color}`}>{role.label}</span>
                                            <div className="flex gap-2">
                                                <select className="text-sm border rounded py-1 w-24" value={assign.playerId??''} onChange={e=>{
                                                    const v = e.target.value===''?null:Number(e.target.value);
                                                    updateHole('gsbi',{playerId:v},null,role.key);
                                                }}>
                                                    <option value="">ç„¡</option>
                                                    {activePlayers.map(p=><option key={p.id} value={p.id}>{p.name}</option>)}
                                                </select>
                                                <button onClick={()=>updateHole('gsbi',{success:!assign.success},null,role.key)}
                                                    disabled={assign.playerId===null}
                                                    className={`px-3 py-1 rounded text-sm font-bold ${assign.success?'bg-green-500 text-white shadow':'bg-gray-200 text-gray-400'}`}>
                                                    {assign.success?'OK':'æœªé€²'}
                                                </button>
                                            </div>
                                        </div>
                                    )
                                })}
                            </div>
                        </div>
                    </div>
                );
            };

            const ScorecardView = () => (
                <div className="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden text-xs pb-24">
                    <div className="overflow-x-auto no-scrollbar">
                        <table className="w-full min-w-[500px]">
                            <thead className="bg-gray-800 text-white">
                                <tr>
                                    <th className="p-2 w-8">H</th>
                                    <th className="p-2 w-8">P</th>
                                    {activePlayers.map(p=><th key={p.id} className="p-2">{p.name}</th>)}
                                </tr>
                            </thead>
                            <tbody className="divide-y divide-gray-100">
                                {holes.map((h, i) => (
                                    <tr key={h.number} className={results.carryOverStatus[i]?'bg-red-50':(h.number%2===0?'bg-gray-50':'bg-white')}>
                                        <td className="p-2 font-bold text-center">{h.number}</td>
                                        <td className="p-2 text-center text-gray-500">{h.par}</td>
                                        {activePlayers.map(p => {
                                            const sc = h.scores[p.id];
                                            const rats = h.rats[p.id];
                                            // Dots for GSBI
                                            const badges = GSBI_ROLES.map(r => 
                                                (h.gsbi[r.key].playerId === p.id && h.gsbi[r.key].success) ? r.dot : null
                                            ).filter(Boolean);
                                            
                                            return (
                                                <td key={p.id} className="p-2 text-center relative h-10">
                                                    <span className="font-bold text-base">{sc??'-'}</span>
                                                    <div className="absolute top-1 right-1 flex flex-col gap-0.5">
                                                        <div className="flex gap-0.5 justify-end">
                                                            {badges.map((color, idx) => <div key={idx} className={`w-2 h-2 rounded-full ${color}`}></div>)}
                                                        </div>
                                                        {rats>0 && <div className="text-[8px] text-red-500 font-bold">ğŸ­{rats}</div>}
                                                    </div>
                                                </td>
                                            );
                                        })}
                                    </tr>
                                ))}
                                <tr className="bg-green-50 font-bold border-t">
                                    <td colSpan={2} className="p-2 text-right">ç¸½è¨ˆ</td>
                                    {activePlayers.map(p=><td key={p.id} className="p-2 text-center text-base">{
                                        formatMoney(results.totals[p.id])
                                    }</td>)}
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            );

            const SettingsView = () => (
                <div className="space-y-6 pb-24">
                    {/* Player Count */}
                    <div className="bg-white rounded-xl shadow-sm border border-gray-100 p-4">
                        <h3 className="font-bold text-gray-800 mb-3 flex gap-2"><Users className="text-purple-600"/> éŠæˆ²äººæ•¸</h3>
                        <div className="flex gap-2">
                            {[2,3,4].map(n => (
                                <button key={n} onClick={()=>setSettings({...settings, playerCount: n})}
                                    className={`flex-1 py-2 rounded-lg font-bold border ${settings.playerCount===n ? 'bg-purple-600 text-white border-purple-600':'bg-white text-gray-600 border-gray-200'}`}>
                                    {n} äºº
                                </button>
                            ))}
                        </div>
                    </div>

                    {/* Rules */}
                    <div className="bg-white rounded-xl shadow-sm border border-gray-100 p-4">
                        <h3 className="font-bold text-gray-800 mb-3 flex gap-2"><TrendingUp className="text-red-600"/> é–€æª»è¦å‰‡</h3>
                        <div className="flex justify-between items-center">
                            <div className="text-sm text-gray-600">æ¨™æº–æ¡¿+1 é–€æª» (æµå±€ç´¯ç©)</div>
                            <button onClick={()=>setSettings({...settings, strictMode: !settings.strictMode})}
                                className={`w-11 h-6 rounded-full relative transition-colors ${settings.strictMode?'bg-red-500':'bg-gray-200'}`}>
                                <span className={`absolute top-1 left-1 bg-white w-4 h-4 rounded-full transition-transform ${settings.strictMode?'translate-x-5':''}`}/>
                            </button>
                        </div>
                    </div>

                    {/* Prices */}
                    <div className="bg-white rounded-xl shadow-sm border border-gray-100 p-4">
                        <h3 className="font-bold text-gray-800 mb-3 flex gap-2"><DollarSign className="text-green-600"/> é‡‘é¡è¨­å®š</h3>
                        <div className="space-y-3">
                            <div className="flex justify-between"><label>é‡‘éŠ€éŠ…éµ/é»</label><input type="number" value={settings.game1Price} onChange={e=>setSettings({...settings, game1Price:Number(e.target.value)})} className="w-20 border rounded text-right px-2"/></div>
                            <div className="flex justify-between"><label>æ¯”æ¡¿/å–®ä½</label><input type="number" value={settings.game2Price} onChange={e=>setSettings({...settings, game2Price:Number(e.target.value)})} className="w-20 border rounded text-right px-2"/></div>
                            <div className="flex justify-between"><label>è€é¼ /éš»</label><input type="number" value={settings.game3Price} onChange={e=>setSettings({...settings, game3Price:Number(e.target.value)})} className="w-20 border rounded text-right px-2"/></div>
                        </div>
                        <div className="mt-2 text-xs text-gray-400">* è«¾èŒ²é­¯ = 5é», é‡‘=4, éŠ€=3, éŠ…=2, éµ=1</div>
                    </div>

                    {/* Players */}
                    <div className="bg-white rounded-xl shadow-sm border border-gray-100 p-4">
                        <h3 className="font-bold text-gray-800 mb-3 flex gap-2"><SettingsIcon className="text-blue-600"/> çƒå“¡è¨­å®š</h3>
                        <div className="space-y-4">
                            {activePlayers.map(p => (
                                <div key={p.id} className="border-b pb-2">
                                    <div className="flex items-center gap-2 mb-2">
                                        <div className={`w-6 h-6 rounded-full flex justify-center items-center text-white text-xs ${['bg-blue-500','bg-green-500','bg-orange-500','bg-purple-500'][p.id]}`}>{String.fromCharCode(65+p.id)}</div>
                                        <input value={p.name} onChange={e=>updatePlayer(p.id,e.target.value)} className="font-bold border-b flex-1"/>
                                    </div>
                                    <div className="flex justify-between gap-2 text-center">
                                        {[3,4,5].map(par=>(
                                            <div key={par} className="flex flex-col w-1/3">
                                                <label className="text-[10px] text-gray-400">P{par}</label>
                                                <input type="number" value={p.handicaps[par]} onChange={e=>updateHandicap(p.id,par,e.target.value)} className="border rounded text-center text-sm"/>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>

                    <button onClick={resetAll} className="w-full py-4 bg-red-50 text-red-600 rounded-xl font-bold flex justify-center gap-2">
                        <RotateCcw/> é‡ç½®æ‰€æœ‰è³‡æ–™
                    </button>
                </div>
            );

            const formatMoney = (v) => <span className={v>0?'text-green-600 font-bold':v<0?'text-red-600 font-bold':'text-gray-400'}>{v>0?'+':''}{v}</span>;

            return (
                <div className="min-h-screen bg-slate-50 flex flex-col max-w-md mx-auto shadow-2xl relative">
                    {/* Top Bar */}
                    <div className="bg-gray-900 text-white sticky top-0 z-10 shadow-lg">
                        <div className="p-4 pb-2 flex justify-between items-center">
                            <h1 className="font-bold flex items-center gap-2"><Circle className="fill-green-400 text-green-400" size={16}/> ç‡’çƒè¨ˆç®—æ©Ÿ v2</h1>
                            <span className="text-xs bg-gray-800 px-2 py-1 rounded">{settings.playerCount}äººå±€</span>
                        </div>
                        <div className="grid grid-cols-4 gap-1 px-2 pb-3 text-center">
                            {activePlayers.map(p => (
                                <div key={p.id} className="bg-gray-800 rounded p-1 flex flex-col">
                                    <span className="text-[10px] text-gray-400 truncate w-full">{p.name}</span>
                                    <span className="text-xs font-mono">{formatMoney(results.totals[p.id])}</span>
                                </div>
                            ))}
                        </div>
                    </div>

                    <div className="p-4 flex-1">
                        {activeTab==='input' && <InputView/>}
                        {activeTab==='scorecard' && <ScorecardView/>}
                        {activeTab==='settings' && <SettingsView/>}
                    </div>

                    <div className="pb-safe text-center text-[10px] text-gray-400 p-2 mt-auto">æ°å¤«|AIæ§“æ¡¿ç­†è¨˜jefu_ai_notes</div>

                    <div className="fixed bottom-0 w-full max-w-md bg-white border-t flex justify-around p-3 pb-safe z-20">
                        <button onClick={()=>setActiveTab('input')} className={`flex flex-col items-center ${activeTab==='input'?'text-green-600':'text-gray-400'}`}><Circle size={24} className={activeTab==='input'?"fill-current":""}/><span className="text-[10px]">è¨˜åˆ†</span></button>
                        <button onClick={()=>setActiveTab('scorecard')} className={`flex flex-col items-center ${activeTab==='scorecard'?'text-green-600':'text-gray-400'}`}><Save size={24}/><span className="text-[10px]">ç¸½è¡¨</span></button>
                        <button onClick={()=>setActiveTab('settings')} className={`flex flex-col items-center ${activeTab==='settings'?'text-green-600':'text-gray-400'}`}><SettingsIcon size={24}/><span className="text-[10px]">è¨­å®š</span></button>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>